"use strict";
/*
 * MIT License
 *
 * Copyright (c) 2019 RÃ©mi Van Keisbelck
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
Object.defineProperty(exports, "__esModule", { value: true });
const jsdom_1 = require("jsdom");
const DocumentEvents_1 = require("./DocumentEvents");
const dom = new jsdom_1.JSDOM();
global.document = dom.window.document;
describe('DocumentEvents Test', () => {
    let documentEvents = new DocumentEvents_1.DocumentEvents();
    const addSpy = jest.fn();
    const removeSpy = jest.fn();
    document.addEventListener = addSpy;
    document.removeEventListener = removeSpy;
    beforeEach(() => {
        documentEvents = new DocumentEvents_1.DocumentEvents();
        addSpy.mockReset();
        removeSpy.mockReset();
    });
    it('first sub adds listener', () => {
        const sub = documentEvents.on('click', (e) => 'clicked');
        sub.init(() => ({}));
        expect(addSpy.mock.calls.length).toBe(1);
    });
    it('second sub adds another listener', () => {
        const sub = documentEvents.on('click', (e) => 'clicked');
        sub.init(() => ({}));
        expect(addSpy.mock.calls.length).toBe(1);
        const sub2 = documentEvents.on('click', (e) => 'clicked2', true);
        sub2.init(() => ({}));
        expect(addSpy.mock.calls.length).toBe(2);
    });
    it('all subs remove listeners', () => {
        const sub = documentEvents.on('click', (e) => 'clicked');
        sub.init(() => ({}));
        const sub2 = documentEvents.on('click', (e) => 'clicked2', { capture: true });
        sub2.init(() => ({}));
        sub.release();
        expect(removeSpy.mock.calls.length).toBe(1);
        sub2.release();
        expect(removeSpy.mock.calls.length).toBe(2);
    });
    it('sub receives event from listener', (done) => {
        const msgs = [];
        const collectMsgs = (msg) => {
            msgs.push(msg);
        };
        const sub = documentEvents.on('click', (e) => 'clicked1');
        sub.init(collectMsgs);
        expect(addSpy.mock.calls.length).toBe(1);
        const listener = addSpy.mock.calls[0][1];
        listener({ event: 'event' });
        setTimeout(() => {
            expect(msgs).toEqual(['clicked1']);
            done();
        }, 10);
    });
    it('each sub receive events its listener', (done) => {
        const msgs = [];
        const collectMsgs = (msg) => {
            msgs.push(msg);
        };
        const msgs2 = [];
        const collectMsgs2 = (msg) => {
            msgs2.push(msg);
        };
        const sub = documentEvents.on('click', (e) => 'clicked');
        const sub2 = documentEvents.on('click', (e) => 'clicked2');
        sub.init(collectMsgs);
        sub2.init(collectMsgs2);
        expect(addSpy.mock.calls.length).toBe(2);
        const listener = addSpy.mock.calls[0][1];
        const listener2 = addSpy.mock.calls[1][1];
        listener({ event: 'event' });
        setTimeout(() => {
            expect(msgs).toEqual(['clicked']);
            listener2({ event: 'event' });
            setTimeout(() => {
                expect(msgs2).toEqual(['clicked2']);
                done();
            }, 10);
        }, 10);
    });
    it('sub stops receiving events from listener', (done) => {
        const sub = documentEvents.on('click', (e) => 'clicked1');
        const msgs = [];
        sub.init((msg) => {
            msgs.push(msg);
        });
        expect(addSpy.mock.calls.length).toBe(1);
        const listener = addSpy.mock.calls[0][1];
        listener({ event: 'event' });
        listener({ event: 'event' });
        setTimeout(() => {
            expect(msgs).toEqual(['clicked1', 'clicked1']);
            sub.release();
            listener({ event: 'event' });
            setTimeout(() => {
                expect(msgs).toEqual(['clicked1', 'clicked1']);
                done();
            });
        }, 10);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRG9jdW1lbnRFdmVudHMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9UZWFDdXAvRG9jdW1lbnRFdmVudHMudGVzdC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXVCRzs7QUFFSCxpQ0FBOEI7QUFDOUIscURBQWtEO0FBRWxELE1BQU0sR0FBRyxHQUFHLElBQUksYUFBSyxFQUFFLENBQUM7QUFDeEIsTUFBTSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztBQUV0QyxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO0lBQ25DLElBQUksY0FBYyxHQUFHLElBQUksK0JBQWMsRUFBRSxDQUFDO0lBRTFDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUN6QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7SUFFNUIsUUFBUSxDQUFDLGdCQUFnQixHQUFHLE1BQU0sQ0FBQztJQUNuQyxRQUFRLENBQUMsbUJBQW1CLEdBQUcsU0FBUyxDQUFDO0lBRXpDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxjQUFjLEdBQUcsSUFBSSwrQkFBYyxFQUFFLENBQUM7UUFDdEMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ25CLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsTUFBTSxHQUFHLEdBQUcsY0FBYyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pELEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXJCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQzFDLE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN6RCxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVyQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXpDLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakUsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFFdEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzQyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsTUFBTSxHQUFHLEdBQUcsY0FBYyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pELEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXJCLE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUM5RSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUV0QixHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZCxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRTVDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNmLE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDOUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUM5QyxNQUFNLElBQUksR0FBYSxFQUFFLENBQUM7UUFDMUIsTUFBTSxXQUFXLEdBQUcsQ0FBQyxHQUFXLEVBQVEsRUFBRTtZQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQztRQUVGLE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMxRCxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXRCLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFekMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDN0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksRUFBRSxDQUFDO1FBQ1QsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ1QsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsc0NBQXNDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRTtRQUNsRCxNQUFNLElBQUksR0FBYSxFQUFFLENBQUM7UUFDMUIsTUFBTSxXQUFXLEdBQUcsQ0FBQyxHQUFXLEVBQVEsRUFBRTtZQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQztRQUNGLE1BQU0sS0FBSyxHQUFhLEVBQUUsQ0FBQztRQUMzQixNQUFNLFlBQVksR0FBRyxDQUFDLEdBQVcsRUFBUSxFQUFFO1lBQ3pDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEIsQ0FBQyxDQUFDO1FBRUYsTUFBTSxHQUFHLEdBQUcsY0FBYyxDQUFDLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sSUFBSSxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUzRCxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFeEIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUxQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUM3QixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDbEMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDOUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtnQkFDZCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxFQUFFLENBQUM7WUFDVCxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDUixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUE7SUFDUixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFO1FBQ3RELE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUxRCxNQUFNLElBQUksR0FBYSxFQUFFLENBQUM7UUFDMUIsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFekMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDN0IsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDN0IsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUUvQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDZCxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUM3QixVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDL0MsSUFBSSxFQUFFLENBQUM7WUFDVCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUNSLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTUlUIExpY2Vuc2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTkgUsOpbWkgVmFuIEtlaXNiZWxja1xuICpcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqXG4gKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbiAqIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4gKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuICogU09GVFdBUkUuXG4gKlxuICovXG5cbmltcG9ydCB7IEpTRE9NIH0gZnJvbSAnanNkb20nO1xuaW1wb3J0IHsgRG9jdW1lbnRFdmVudHMgfSBmcm9tICcuL0RvY3VtZW50RXZlbnRzJztcblxuY29uc3QgZG9tID0gbmV3IEpTRE9NKCk7XG5nbG9iYWwuZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50O1xuXG5kZXNjcmliZSgnRG9jdW1lbnRFdmVudHMgVGVzdCcsICgpID0+IHtcbiAgbGV0IGRvY3VtZW50RXZlbnRzID0gbmV3IERvY3VtZW50RXZlbnRzKCk7XG5cbiAgY29uc3QgYWRkU3B5ID0gamVzdC5mbigpO1xuICBjb25zdCByZW1vdmVTcHkgPSBqZXN0LmZuKCk7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciA9IGFkZFNweTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IHJlbW92ZVNweTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBkb2N1bWVudEV2ZW50cyA9IG5ldyBEb2N1bWVudEV2ZW50cygpO1xuICAgIGFkZFNweS5tb2NrUmVzZXQoKTtcbiAgICByZW1vdmVTcHkubW9ja1Jlc2V0KCk7XG4gIH0pO1xuXG4gIGl0KCdmaXJzdCBzdWIgYWRkcyBsaXN0ZW5lcicsICgpID0+IHtcbiAgICBjb25zdCBzdWIgPSBkb2N1bWVudEV2ZW50cy5vbignY2xpY2snLCAoZSkgPT4gJ2NsaWNrZWQnKTtcbiAgICBzdWIuaW5pdCgoKSA9PiAoe30pKTtcblxuICAgIGV4cGVjdChhZGRTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIGl0KCdzZWNvbmQgc3ViIGFkZHMgYW5vdGhlciBsaXN0ZW5lcicsICgpID0+IHtcbiAgICBjb25zdCBzdWIgPSBkb2N1bWVudEV2ZW50cy5vbignY2xpY2snLCAoZSkgPT4gJ2NsaWNrZWQnKTtcbiAgICBzdWIuaW5pdCgoKSA9PiAoe30pKTtcblxuICAgIGV4cGVjdChhZGRTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG5cbiAgICBjb25zdCBzdWIyID0gZG9jdW1lbnRFdmVudHMub24oJ2NsaWNrJywgKGUpID0+ICdjbGlja2VkMicsIHRydWUpO1xuICAgIHN1YjIuaW5pdCgoKSA9PiAoe30pKTtcblxuICAgIGV4cGVjdChhZGRTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMik7XG4gIH0pO1xuXG4gIGl0KCdhbGwgc3VicyByZW1vdmUgbGlzdGVuZXJzJywgKCkgPT4ge1xuICAgIGNvbnN0IHN1YiA9IGRvY3VtZW50RXZlbnRzLm9uKCdjbGljaycsIChlKSA9PiAnY2xpY2tlZCcpO1xuICAgIHN1Yi5pbml0KCgpID0+ICh7fSkpO1xuXG4gICAgY29uc3Qgc3ViMiA9IGRvY3VtZW50RXZlbnRzLm9uKCdjbGljaycsIChlKSA9PiAnY2xpY2tlZDInLCB7IGNhcHR1cmU6IHRydWUgfSk7XG4gICAgc3ViMi5pbml0KCgpID0+ICh7fSkpO1xuXG4gICAgc3ViLnJlbGVhc2UoKTtcbiAgICBleHBlY3QocmVtb3ZlU3B5Lm1vY2suY2FsbHMubGVuZ3RoKS50b0JlKDEpO1xuXG4gICAgc3ViMi5yZWxlYXNlKCk7XG4gICAgZXhwZWN0KHJlbW92ZVNweS5tb2NrLmNhbGxzLmxlbmd0aCkudG9CZSgyKTtcbiAgfSk7XG5cbiAgaXQoJ3N1YiByZWNlaXZlcyBldmVudCBmcm9tIGxpc3RlbmVyJywgKGRvbmUpID0+IHtcbiAgICBjb25zdCBtc2dzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IGNvbGxlY3RNc2dzID0gKG1zZzogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICBtc2dzLnB1c2gobXNnKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgc3ViID0gZG9jdW1lbnRFdmVudHMub24oJ2NsaWNrJywgKGUpID0+ICdjbGlja2VkMScpO1xuICAgIHN1Yi5pbml0KGNvbGxlY3RNc2dzKTtcblxuICAgIGV4cGVjdChhZGRTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgY29uc3QgbGlzdGVuZXIgPSBhZGRTcHkubW9jay5jYWxsc1swXVsxXTtcblxuICAgIGxpc3RlbmVyKHsgZXZlbnQ6ICdldmVudCcgfSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBleHBlY3QobXNncykudG9FcXVhbChbJ2NsaWNrZWQxJ10pO1xuICAgICAgZG9uZSgpO1xuICAgIH0sIDEwKTtcbiAgfSk7XG5cbiAgaXQoJ2VhY2ggc3ViIHJlY2VpdmUgZXZlbnRzIGl0cyBsaXN0ZW5lcicsIChkb25lKSA9PiB7XG4gICAgY29uc3QgbXNnczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBjb2xsZWN0TXNncyA9IChtc2c6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgICAgbXNncy5wdXNoKG1zZyk7XG4gICAgfTtcbiAgICBjb25zdCBtc2dzMjogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBjb2xsZWN0TXNnczIgPSAobXNnOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICAgIG1zZ3MyLnB1c2gobXNnKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgc3ViID0gZG9jdW1lbnRFdmVudHMub24oJ2NsaWNrJywgKGUpID0+ICdjbGlja2VkJyk7XG4gICAgY29uc3Qgc3ViMiA9IGRvY3VtZW50RXZlbnRzLm9uKCdjbGljaycsIChlKSA9PiAnY2xpY2tlZDInKTtcblxuICAgIHN1Yi5pbml0KGNvbGxlY3RNc2dzKTtcbiAgICBzdWIyLmluaXQoY29sbGVjdE1zZ3MyKTtcblxuICAgIGV4cGVjdChhZGRTcHkubW9jay5jYWxscy5sZW5ndGgpLnRvQmUoMik7XG4gICAgY29uc3QgbGlzdGVuZXIgPSBhZGRTcHkubW9jay5jYWxsc1swXVsxXTtcbiAgICBjb25zdCBsaXN0ZW5lcjIgPSBhZGRTcHkubW9jay5jYWxsc1sxXVsxXTtcblxuICAgIGxpc3RlbmVyKHsgZXZlbnQ6ICdldmVudCcgfSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBleHBlY3QobXNncykudG9FcXVhbChbJ2NsaWNrZWQnXSk7XG4gICAgICBsaXN0ZW5lcjIoeyBldmVudDogJ2V2ZW50JyB9KTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBleHBlY3QobXNnczIpLnRvRXF1YWwoWydjbGlja2VkMiddKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSwgMTApXG4gICAgfSwgMTApXG4gIH0pO1xuXG4gIGl0KCdzdWIgc3RvcHMgcmVjZWl2aW5nIGV2ZW50cyBmcm9tIGxpc3RlbmVyJywgKGRvbmUpID0+IHtcbiAgICBjb25zdCBzdWIgPSBkb2N1bWVudEV2ZW50cy5vbignY2xpY2snLCAoZSkgPT4gJ2NsaWNrZWQxJyk7XG5cbiAgICBjb25zdCBtc2dzOiBzdHJpbmdbXSA9IFtdO1xuICAgIHN1Yi5pbml0KChtc2cpID0+IHtcbiAgICAgIG1zZ3MucHVzaChtc2cpO1xuICAgIH0pO1xuXG4gICAgZXhwZWN0KGFkZFNweS5tb2NrLmNhbGxzLmxlbmd0aCkudG9CZSgxKTtcbiAgICBjb25zdCBsaXN0ZW5lciA9IGFkZFNweS5tb2NrLmNhbGxzWzBdWzFdO1xuXG4gICAgbGlzdGVuZXIoeyBldmVudDogJ2V2ZW50JyB9KTtcbiAgICBsaXN0ZW5lcih7IGV2ZW50OiAnZXZlbnQnIH0pO1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgZXhwZWN0KG1zZ3MpLnRvRXF1YWwoWydjbGlja2VkMScsICdjbGlja2VkMSddKTtcblxuICAgICAgc3ViLnJlbGVhc2UoKTtcbiAgICAgIGxpc3RlbmVyKHsgZXZlbnQ6ICdldmVudCcgfSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgZXhwZWN0KG1zZ3MpLnRvRXF1YWwoWydjbGlja2VkMScsICdjbGlja2VkMSddKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSk7XG4gICAgfSwgMTApXG4gIH0pO1xuXG59KTtcbiJdfQ==